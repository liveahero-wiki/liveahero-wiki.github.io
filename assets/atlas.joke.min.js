'use strict';class AtlasStitcher{constructor(){this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")}draw(a,c,b,f){const k=a.height,h=a.width;var e=c.width;const g=c.height,l=b.padding;b=b.cellSize;const d=b-2*l,n=e+d-1-(e+d-1)%d,p=g+d-1-(g+d-1)%d;this.canvas.width=e;this.canvas.height=g;this.ctx.clearRect(0,0,e,g);e=0;for(const m of c.cellIndexList){if(m!=c.transparentIndex){const q=e%(n/d)*d,r=p-d*(1+intdiv(e,n/d))-(p-g),t=m%(h/b)*b+l,u=k-b*(1+intdiv(m,h/b))+l;this.ctx.drawImage(a,t,u,d,d,q,r,d,d)}e++}this.canvas.toBlob(m=>{f.src.startsWith("blob")&&URL.revokeObjectURL(f.src);f.src=URL.createObjectURL(m)},"image/png")}}async function getJson(a){return await Promise.all(a.map(c=>fetch(`/cdn/MonoBehaviour/${c}.json`)))}async function collectSprites(a,c){const b={};for(const f of a){if(200!=f.status){console.log(f);continue}a=await f.json();const k=a.m_Name;b[k]=a;for(const h of a.textureDataList)c.add(new Option(h.name,`${k}:${h.name}`))}return b}const atlasObserver=new IntersectionObserver((a,c)=>{a.forEach(b=>{b.isIntersecting&&(atlasHandler(b.target),c.unobserve(b.target))})}),aprilFoolSpriteMap={alphecca:"takemaru01",alchiba:"thunderbird01_skin1",akashi:"gunzou01",andrew:"jacob01",astar:"goblinfire01b_skin2",astosis:"pazuzu01",barrel:"tindalos01",cerastium:"ziz01",danzo:"shiva01",exio:"nekros01_skin1",furlong:"xolotl01",gammei:"https@//api.housamo.xyz/housamo/unity/atlas/?mode=png&asset=/housamo/adv/Android/texture/character/fg_kyouma01&name=fg_kyouma01&use_filename=asset.png",garbo:"qinglong01",gomeisa:"wakantanka01",goro:"kimunkamui01",guardmanFire:"orgus01",hisaki:"cusith01",huckle:"leib01",isaribi:"typhon01",kyoichi:"taurus01_skin1",marfik:"amatsumara01",melide:"alice01",lilac:"sandayu01",loren:"ryouta01",obsidius:"shennong01",polaris:"aegir01",procy:"shino01_skin2",pubraseer:"breke01",sadayoshi:"seth01",sensettia:"benten01_skin9",suhail:"jormungandr01",sui:"arc01",victom:"algernon01",yohack:"moritaka01",yuhang:"boogeyman01h",zaniah:"hakumen01"},APRIL_FOOL="april_fool";function addAprilFoolSprite(a,c){a=a[0].split("_")[1];a=aprilFoolSpriteMap[a];void 0!==a&&(a=`${APRIL_FOOL}:${a}`,c.prepend(new Option(APRIL_FOOL,a)),c.value=a)}async function atlasHandler(a){const c=a.dataset.sprites.split(","),b=a.querySelector("img"),f=a.querySelector("select"),k=await getJson(c),h=await collectSprites(k,f);addAprilFoolSprite(c,f);a.appendChild(f);a=()=>{const e=f.value.split(":");if(e[0]==APRIL_FOOL)e[1].startsWith("http")?b.src=e[1].replace("@",":"):b.src=`https://cdn.housamo.xyz/housamo/unity/Android/fg/fg_${e[1]}.png`;else{var g=h[e[0]],l=g.textureDataList.find(n=>n.name==e[1]),d=new Image;d.onload=()=>{window.atlasSticher=window.atlasSticher||new AtlasStitcher;atlasSticher.draw(d,l,g,b)};d.src=`/cdn/Texture2D/${l.atlasName}.png`}};a();f.addEventListener("change",a)}document.querySelectorAll(".atlas-gallery").forEach(a=>atlasObserver.observe(a));function intdiv(a,c){return Math.floor(a/c)};